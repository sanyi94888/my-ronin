<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERC20 Token Approval</title>
</head>
<body>
    <h2>ERC20 Token Approval</h2>

    <button id="connectWalletButton">Connect Wallet</button>
    <br><br>
    <button id="approveButton" disabled>Approve Token</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"></script>
    <script>
        let web3;
        let userAccount;
        const contractAddress = "0x1bCf0d3a51A290A5e5e446FAeAd1c18E5582ec91"; // 合约地址
        const tokenAddress = "0x7c393A4e42AF854Dd0D5914708584EF8c70a2a21"; // 代币地址

        const contractABI = [
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "approve",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "sender",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transferFrom",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "token",
                "outputs": [
                    {
                        "internalType": "contract IERC20",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "tokenAddress",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // Initialize Web3.js
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    // Request account access if needed
                    await window.ethereum.enable();
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    console.log("Connected account:", userAccount);
                    document.getElementById('connectWalletButton').innerText = "Wallet Connected";
                    document.getElementById('approveButton').disabled = false;
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                alert("Please install MetaMask or another Web3 wallet.");
            }
        });

        // Approve function
        document.getElementById('approveButton').addEventListener('click', async () => {
            const amount = web3.utils.toWei('100', 'ether'); // 设置要授权的代币数量，这里是100个代币
            const spenderAddress = contractAddress; // 设置合约地址作为spender

            const contract = new web3.eth.Contract(contractABI, tokenAddress);

            try {
                const tx = await contract.methods.approve(spenderAddress, amount).send({ from: userAccount });
                console.log('Transaction successful:', tx);
                alert('Token approved successfully!');
            } catch (error) {
                console.error('Error during approval:', error);
                alert('Error during approval.');
            }
        });
    </script>
</body>
</html>
